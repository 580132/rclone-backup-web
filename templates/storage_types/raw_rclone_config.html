<!-- 原始rclone配置字段 -->
<div id="raw_rclone_fields" class="config-fields" style="display: none;">
    <div class="config-info-box warning mb-3">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <strong>高级配置</strong> - 直接编写rclone配置，支持所有rclone支持的存储类型
    </div>
    
    <div class="mb-3">
        <label for="rclone_config" class="form-label">rclone配置 *</label>
        <textarea class="form-control" id="rclone_config" name="rclone_config" rows="12" 
                  data-required="true" placeholder="请输入rclone配置，支持两种格式：

格式1 - key=value格式：
type=s3
provider=AWS
access_key_id=your_access_key
secret_access_key=your_secret_key
region=us-east-1

格式2 - INI格式：
[remote]
type=s3
provider=AWS
access_key_id=your_access_key
secret_access_key=your_secret_key
region=us-east-1"></textarea>
        <div class="form-text">直接输入rclone配置参数，支持key=value或INI格式</div>
    </div>
    
    <div class="config-info-box info mt-3">
        <i class="bi bi-info-circle me-2"></i>
        <strong>支持的格式：</strong>
        <ul class="mb-0 mt-2">
            <li><strong>key=value格式：</strong>每行一个配置项，格式为 key=value</li>
            <li><strong>INI格式：</strong>标准的INI配置文件格式，包含[section]</li>
            <li><strong>注释：</strong>支持 # 开头的注释行</li>
            <li><strong>必填字段：</strong>必须包含 type 字段指定存储类型</li>
        </ul>
    </div>
    
    <div class="config-info-box info mt-3">
        <i class="bi bi-lightbulb me-2"></i>
        <strong>常见存储类型示例：</strong>
        <div class="mt-2">
            <button type="button" class="btn btn-outline-info btn-sm me-2" onclick="fillExample('s3')">S3示例</button>
            <button type="button" class="btn btn-outline-info btn-sm me-2" onclick="fillExample('dropbox')">Dropbox示例</button>
            <button type="button" class="btn btn-outline-info btn-sm me-2" onclick="fillExample('onedrive')">OneDrive示例</button>
            <button type="button" class="btn btn-outline-info btn-sm me-2" onclick="fillExample('box')">Box示例</button>
            <button type="button" class="btn btn-outline-info btn-sm" onclick="fillExample('azureblob')">Azure Blob示例</button>
        </div>
    </div>
    
    <div class="config-info-box warning mt-3">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <strong>注意事项：</strong>
        <ul class="mb-0 mt-2">
            <li>请确保配置格式正确，系统会验证配置的有效性</li>
            <li>敏感信息（如密码、密钥）请谨慎填写</li>
            <li>建议先在本地测试rclone配置的有效性</li>
            <li>此功能适用于高级用户和特殊存储需求</li>
        </ul>
    </div>
    
    <div class="config-info-box info mt-3">
        <i class="bi bi-book me-2"></i>
        <strong>参考文档：</strong>
        <ul class="mb-0 mt-2">
            <li><a href="https://rclone.org/docs/" target="_blank" class="text-info">rclone官方文档</a></li>
            <li><a href="https://rclone.org/overview/" target="_blank" class="text-info">支持的存储类型</a></li>
            <li><a href="https://rclone.org/commands/rclone_config/" target="_blank" class="text-info">配置参数说明</a></li>
        </ul>
    </div>
</div>

<script>
// 填充示例配置
function fillExample(type) {
    const textarea = document.getElementById('rclone_config');
    let example = '';
    
    switch(type) {
        case 's3':
            example = `type=s3
provider=AWS
access_key_id=your_access_key_here
secret_access_key=your_secret_key_here
region=us-east-1
# 可选：自定义端点
# endpoint=s3.example.com`;
            break;
            
        case 'dropbox':
            example = `type=dropbox
# Dropbox使用OAuth2认证，需要通过rclone config设置
# 或者使用应用密钥
app_key=your_app_key
app_secret=your_app_secret`;
            break;
            
        case 'onedrive':
            example = `type=onedrive
# OneDrive使用OAuth2认证
# 可以指定驱动器类型
drive_type=personal
# 或者 drive_type=business`;
            break;
            
        case 'box':
            example = `type=box
# Box使用OAuth2认证
client_id=your_client_id
client_secret=your_client_secret`;
            break;
            
        case 'azureblob':
            example = `type=azureblob
account=your_storage_account
key=your_storage_key
# 或者使用SAS URL
# sas_url=your_sas_url`;
            break;
    }
    
    if (example) {
        textarea.value = example;
        // 触发输入事件以便其他脚本处理
        textarea.dispatchEvent(new Event('input'));
    }
}

// 配置验证
document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.getElementById('rclone_config');
    if (textarea) {
        textarea.addEventListener('input', function() {
            validateRcloneConfig(this.value);
        });
    }
});

function validateRcloneConfig(config) {
    const lines = config.trim().split('\n');
    let hasType = false;
    let errors = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line || line.startsWith('#')) continue;
        
        if (line.includes('=')) {
            const [key, value] = line.split('=', 2);
            if (key.trim() === 'type') {
                hasType = true;
            }
        } else if (!line.startsWith('[') || !line.endsWith(']')) {
            errors.push(`第${i+1}行格式错误: ${line}`);
        }
    }
    
    if (!hasType && config.trim()) {
        errors.push('配置中缺少必需的 type 字段');
    }
    
    // 显示验证结果（可以添加UI反馈）
    if (errors.length > 0) {
        console.log('配置验证错误:', errors);
    }
}
</script>
