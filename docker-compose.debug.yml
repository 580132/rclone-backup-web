# Docker Compose 调试配置文件
# 使用方法: docker-compose -f docker-compose.yml -f docker-compose.debug.yml up -d
# 这个文件会覆盖主配置文件中的日志设置，开启最详细的调试日志

version: '3.8'

services:
  backup-web:
    environment:
      # 开启最详细的应用调试日志
      - LOG_LEVEL=DEBUG
      # 开发模式（可选）
      - FLASK_ENV=development

  rclone:
    environment:
      # 开启最详细的rclone调试日志
      - RCLONE_LOG_LEVEL=DEBUG
    # 覆盖command以使用DEBUG级别
    command: [
      "rcd",
      "--rc-addr=0.0.0.0:5572",
      "--rc-no-auth",
      "--log-level=DEBUG",
      "--log-file=/app/data/rclone.log",
      "--verbose=2"  # 额外的详细输出
    ]

# ==========================================
# 使用说明
# ==========================================
#
# 1. 启动调试模式：
#    docker-compose -f docker-compose.yml -f docker-compose.debug.yml up -d
#
# 2. 查看实时日志：
#    docker-compose logs -f backup-web  # 查看主应用日志
#    docker-compose logs -f rclone      # 查看rclone容器日志
#    tail -f ./logs/app.log             # 查看应用日志文件
#    tail -f ./data/rclone.log          # 查看rclone日志文件
#
# 3. 恢复正常模式：
#    docker-compose -f docker-compose.yml up -d
#
# 注意：调试模式会产生大量日志，请确保有足够的磁盘空间
# ==========================================
